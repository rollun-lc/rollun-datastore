# Documentation Fixes - Action Plan
## rollun-datastore Library

**Created:** 2025-10-29
**Priority:** HIGH
**Estimated Effort:** 8-16 hours for all fixes
**Impact:** CRITICAL - Affects all developers using this library

---

## Executive Summary

This action plan provides step-by-step instructions to fix 13 critical errors and numerous minor issues in the LLM-generated documentation. Following this plan will increase documentation accuracy from 52% to ~95%.

---

## Priority Levels

- üî¥ **P0 - CRITICAL:** Blocks usage, must fix immediately
- üü° **P1 - HIGH:** Significant errors, fix within 1 week
- üü† **P2 - MEDIUM:** Minor errors, fix within 1 month
- üü¢ **P3 - LOW:** Cosmetic issues, fix when convenient

---

## Phase 1: Critical Fixes (P0) - 2-4 hours

### Fix 1.1: Remove Fabricated Method - multiDelete()
**Priority:** üî¥ P0 - CRITICAL
**Location:** `non_examined_llm_docs/api_reference.md:66-74`
**Impact:** Developers will try to call non-existent method

**Current (INCORRECT):**
```php
/**
 * –£–¥–∞–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π
 *
 * @param array $ids
 * @return array –ú–∞—Å—Å–∏–≤ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤
 * @throws DataStoreException
 */
public function multiDelete($ids);
```

**Action:** DELETE this entire section

**Reason:** Method does not exist in code (verified via grep)

**Estimated Time:** 2 minutes

---

### Fix 1.2: Correct delete() Return Type
**Priority:** üî¥ P0 - CRITICAL
**Location:** `non_examined_llm_docs/api_reference.md:58-65`
**Impact:** Type errors in developer code

**Current (INCORRECT):**
```php
/**
 * –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É
 *
 * @param int|string $id
 * @return bool
 * @throws DataStoreException
 */
public function delete($id);
```

**Correct (from source):**
```php
/**
 * Delete record by identifier in data store.
 * Method should return deleted record.
 *
 * @param int|string $id
 * @return array|\ArrayObject|BaseDto|object
 * @throws DataStoreException
 */
public function delete($id);
```

**Source:** `src/DataStore/src/DataStore/Interfaces/DataStoreInterface.php:101-107`

**Action:** REPLACE with corrected version above

**Estimated Time:** 3 minutes

---

### Fix 1.3: Add Missing Methods to DataStoreInterface
**Priority:** üî¥ P0 - CRITICAL
**Location:** `non_examined_llm_docs/api_reference.md:28-74` (insert after update methods)
**Impact:** Developers unaware of important functionality

**Missing Methods:**

**1. queriedUpdate():**
```php
/**
 * Update records by query:
 * - if identifier specified in record it should throw exception
 * - it should return list of updated record IDs
 * - if regular record is not exist or record can't be updated it should pass it and start update next one
 *
 * @param array|\ArrayObject|BaseDto|object $record
 * @param Query $query
 * @return array Array of updated identifiers
 * @throws DataStoreException
 */
public function queriedUpdate($record, Query $query);
```

**2. queriedDelete():**
```php
/**
 * Delete records by query:
 * - it should return list of deleted record IDs
 * - if regular record is not exist or record can't be deleted it should pass it and start delete next one
 *
 * @param Query $query
 * @return array Array of deleted identifiers
 * @throws DataStoreException
 */
public function queriedDelete(Query $query);
```

**3. rewrite():**
```php
/**
 * Create record if it does not exist or update if it exists:
 * - if identifier is not specified, it should be autogenerated on application level
 * - if record can't be rewrote, it should throw exception
 * - it should return rewrote record
 *
 * @param array|\ArrayObject|BaseDto|object $record
 * @return array|\ArrayObject|BaseDto
 * @throws DataStoreException
 */
public function rewrite($record);
```

**Source:** `src/DataStore/src/DataStore/Interfaces/DataStoreInterface.php:87, 117, 98`

**Action:** INSERT these three methods in api_reference.md after multiUpdate()

**Estimated Time:** 10 minutes

---

### Fix 1.4: Fix DataStoresInterface - Remove Wrong Methods
**Priority:** üî¥ P0 - CRITICAL
**Location:** `non_examined_llm_docs/api_reference.md:77-133`
**Impact:** Confusion about interface responsibilities

**Methods to REMOVE from DataStoresInterface documentation:**
1. ‚ùå `queriedUpdate()` - belongs to DataStoreInterface
2. ‚ùå `queriedDelete()` - belongs to DataStoreInterface
3. ‚ùå `refresh()` - belongs to RefreshableInterface (separate)

**Method to ADD to DataStoresInterface:**
```php
/**
 * Delete all Items.
 *
 * @return int number of deleted items or null if object doesn't support it
 */
public function deleteAll();
```

**Source:** `src/DataStore/src/DataStore/Interfaces/DataStoresInterface.php:70`

**Corrected DataStoresInterface (FULL REPLACEMENT):**
```php
interface DataStoresInterface extends ReadInterface
{
    /**
     * By default, insert new item.
     * It can't overwrite existing item by default.
     *
     * If $itemData['id'] !== null, item set with that 'id'.
     * If item with same 'id' already exist - method will throw exception,
     * but if $rewriteIfExist = true item will be rewrote.
     *
     * If $itemData['id'] is not set or $itemData['id']===null,
     * item will be insert with autoincrement primary key.
     *
     * @param array $itemData associated array with or without primary key
     * @param bool $rewriteIfExist can item be rewrote if same 'id' exist
     * @return array created item or method will throw exception
     * @throws DataStoreException
     */
    public function create($itemData, $rewriteIfExist = false);

    /**
     * By default, update existing item.
     *
     * If item with PrimaryKey == $itemData['id'] is existing in the store, item will update.
     * Fields which don't present in $itemData will not be changed in item in the store.
     * This method return updated item.
     *
     * If $item['id'] isn't set - the method will throw exception.
     *
     * If item with primary key == $itemData['id'] is absent in the store - method will throw exception,
     * but if $createIfAbsent = true item will be created and this method return inserted item.
     *
     * @param array $itemData associated array with primary key
     * @param bool $createIfAbsent can item be created if same 'id' is absent in the store
     * @return array updated or inserted item
     * @throws DataStoreException
     */
    public function update($itemData, $createIfAbsent = false);

    /**
     * Delete Item by 'id'. Method do nothing if item with that id is absent.
     *
     * @param int|string $id primary key
     * @return array deleted record or null if not supported
     * @throws DataStoreException
     */
    public function delete($id);

    /**
     * Delete all Items.
     *
     * @return int number of deleted items or null if object doesn't support it
     */
    public function deleteAll();
}
```

**Action:** REPLACE entire DataStoresInterface section with corrected version above

**Estimated Time:** 15 minutes

---

### Fix 1.5: Fix CsvBase Constants
**Priority:** üî¥ P0 - CRITICAL
**Location:** `non_examined_llm_docs/api_reference.md:348-350`
**Impact:** Wrong default values in CSV processing

**Current (ALL INCORRECT):**
```php
protected const MAX_FILE_SIZE_FOR_CACHE = 1048576;
protected const MAX_LOCK_TRIES = 10;
protected const DEFAULT_DELIMITER = ',';
```

**Correct (from source):**
```php
protected const MAX_FILE_SIZE_FOR_CACHE = 8388608;  // 8MB not 1MB
protected const MAX_LOCK_TRIES = 30;                // 30 not 10
protected const DEFAULT_DELIMITER = ';';            // semicolon not comma
```

**Source:** `src/DataStore/src/DataStore/CsvBase.php:24-26`

**Action:** REPLACE with corrected values

**Estimated Time:** 2 minutes

---

### Fix 1.6: Document RefreshableInterface Separately
**Priority:** üî¥ P0 - CRITICAL
**Location:** `non_examined_llm_docs/api_reference.md` (add new section)
**Impact:** Clarity on refresh() functionality

**Add New Section:**
```markdown
### RefreshableInterface

Interface for refreshing cached data.

```php
interface RefreshableInterface
{
    /**
     * Refresh cached data from source
     *
     * @return null
     * @throws DataStoreException
     */
    public function refresh();
}
```

**Implementations:**
- `Cacheable` - Refreshes cache from data source

**Location:** `rollun\datastore\DataStore\Interfaces\RefreshableInterface`
**File:** `src/DataStore/src/DataStore/Interfaces/RefreshableInterface.php`
```

**Action:** ADD new section after DataStoresInterface

**Estimated Time:** 5 minutes

---

**Phase 1 Total Time:** ~40 minutes
**Phase 1 Impact:** Fixes all 6 critical errors that block usage

---

## Phase 2: High Priority Fixes (P1) - 2-4 hours

### Fix 2.1: Replace api_reference.md with ULTRA_DETAILED Content
**Priority:** üü° P1 - HIGH
**Effort:** HIGH (2-3 hours)
**Impact:** Major improvement in accuracy

**Strategy:**
Instead of fixing api_reference.md line-by-line, **extract verified content from ULTRA_DETAILED files**:

**Step 1:** Extract DataStore sections from ULTRA_DETAILED_DATASTORES.md
- Copy DataStoreAbstract section (verified 85% accurate)
- Copy Memory, DbTable, HttpClient sections
- Copy CsvBase section with CORRECTED constants

**Step 2:** Extract Middleware sections from ENDPOINT_ANALYSIS_DETAILED.md
- Copy DataStoreApi section (verified 90% accurate)
- Copy ResourceResolver section
- Copy RequestDecoder section

**Step 3:** Extract Handler sections from ULTRA_DETAILED_HANDLERS.md
- Copy all Handler classes

**Step 4:** Keep existing Repository and Uploader sections (verified 80-90%)

**Step 5:** Reorganize into coherent structure

**Alternative (Lower Effort):** Add prominent notice:
```markdown
# API Reference

‚ö†Ô∏è **DEPRECATION NOTICE:** This document has known accuracy issues (52%).

**For accurate information, please refer to:**
- [ULTRA_DETAILED_DATASTORES.md](ULTRA_DETAILED_DATASTORES.md) - DataStore classes
- [ENDPOINT_ANALYSIS_DETAILED.md](ENDPOINT_ANALYSIS_DETAILED.md) - HTTP API
- [ULTRA_DETAILED_HANDLERS.md](ULTRA_DETAILED_HANDLERS.md) - HTTP handlers

Full verification report: [LLM_DOCUMENTATION_VERIFICATION_REPORT.md](../LLM_DOCUMENTATION_VERIFICATION_REPORT.md)
```

**Estimated Time:** 2-3 hours (full rewrite) OR 5 minutes (deprecation notice)

---

### Fix 2.2: Add Deprecation Warnings
**Priority:** üü° P1 - HIGH
**Location:** Multiple places in documentation
**Impact:** Prevent use of deprecated features

**Add warnings for:**

1. **Memory constructor columns parameter:**
```php
/**
 * @param array $columns Required columns
 * @deprecated Specifying columns triggers deprecation warning
 */
public function __construct(array $columns = [])
```

2. **rewriteIfExist parameter:**
```php
/**
 * @param bool $rewriteIfExist DEPRECATED: No longer used
 */
public function create($itemData, $rewriteIfExist = false)
```

3. **createIfAbsent parameter:**
```php
/**
 * @param bool $createIfAbsent DEPRECATED: No longer used
 */
public function update($itemData, $createIfAbsent = false)
```

4. **Range header:**
```markdown
‚ö†Ô∏è **DEPRECATED:** The `Range` header is deprecated. Use RQL `limit()` instead.
```

5. **getIterator():**
```php
/**
 * @return \Traversable
 * @deprecated "Datastore is no more iterable" - triggers E_USER_DEPRECATED
 */
public function getIterator(): \Traversable
```

**Action:** Add deprecation notices in all relevant places

**Estimated Time:** 30 minutes

---

### Fix 2.3: Remove False Verification Claims
**Priority:** üü° P1 - HIGH
**Location:** All "VERIFIED" and "FINAL" report files
**Impact:** Prevent false confidence

**Files to Update:**

1. **VERIFIED_ANALYSIS.md** - Add disclaimer at top:
```markdown
# ‚ö†Ô∏è VERIFICATION STATUS: OUTDATED

This document claims "100% verification" but external code verification found only ~65% accuracy.

See actual verification: [LLM_DOCUMENTATION_VERIFICATION_REPORT.md](../LLM_DOCUMENTATION_VERIFICATION_REPORT.md)
```

2. **FINAL_VERIFIED_REPORT.md** - Same disclaimer

3. **ULTRA_DETAILED_FINAL_REPORT.md** - Same disclaimer

4. **CRITICAL_REVIEW_REPORT.md** - Same disclaimer

**OR Delete these files entirely** (recommended)

**Estimated Time:** 15 minutes (add disclaimers) OR 2 minutes (delete files)

---

**Phase 2 Total Time:** 3-4 hours
**Phase 2 Impact:** Improves trust and prevents misuse

---

## Phase 3: Medium Priority Fixes (P2) - 2-4 hours

### Fix 3.1: Verify and Fix Code Examples
**Priority:** üü† P2 - MEDIUM
**Location:** `non_examined_llm_docs/examples.md`
**Impact:** Examples must be runnable

**Process:**
1. Extract all PHP code blocks from examples.md
2. Check syntax with `php -l`
3. Verify class/method names exist
4. Remove examples using non-existent methods (multiDelete)
5. Update examples with deprecated warnings

**Estimated Time:** 2 hours

---

### Fix 3.2: Add Source Code References
**Priority:** üü† P2 - MEDIUM
**Location:** Throughout documentation
**Impact:** Easy verification by developers

**Add file/line references for all major components:**

Example:
```markdown
### DataStoreAbstract

**Location:** `src/DataStore/src/DataStore/DataStoreAbstract.php:26`
**Implements:** `DataStoresInterface`, `DataStoreInterface`
```

**Estimated Time:** 1 hour

---

### Fix 3.3: Create Consistency Index
**Priority:** üü† P2 - MEDIUM
**Location:** New file
**Impact:** Help developers find correct information

**Create:** `DOCUMENTATION_INDEX.md`

```markdown
# Documentation Index - Where to Find Accurate Information

## ‚úÖ Highly Accurate (85-95%)
- ULTRA_DETAILED_DATASTORES.md
- ENDPOINT_ANALYSIS_DETAILED.md
- ULTRA_DETAILED_HANDLERS.md

## ‚ö†Ô∏è Use With Caution (50-70%)
- api_reference.md (critical errors - see fixes)
- configuration.md (some parameters incorrect)

## üìã By Component

### DataStore Classes
‚úÖ Use: ULTRA_DETAILED_DATASTORES.md (85% accurate)

### HTTP API
‚úÖ Use: ENDPOINT_ANALYSIS_DETAILED.md (90% accurate)

### RQL Components
‚ö†Ô∏è Use: RQL_COMPONENTS_ANALYSIS.md (80% accurate - spot checked only)

### Repository
‚úÖ Use: api_reference.md Repository section (80% accurate)

### Uploader
‚úÖ Use: api_reference.md Uploader section (90% accurate)
```

**Estimated Time:** 30 minutes

---

**Phase 3 Total Time:** 3-4 hours
**Phase 3 Impact:** Improves developer experience

---

## Phase 4: Low Priority (P3) - 2-4 hours

### Fix 4.1: Formatting and Style Consistency
- Consistent code block formatting
- Consistent heading levels
- Remove duplicate content

### Fix 4.2: Add Table of Contents
- Auto-generated TOC for long files
- Cross-references between files

### Fix 4.3: Translation Review
- Check Russian translation accuracy
- Ensure technical terms are correct

**Estimated Time:** 2-4 hours

---

## Implementation Checklist

### Immediate (Today)
- [ ] Fix 1.1: Remove multiDelete() (2 min)
- [ ] Fix 1.2: Correct delete() return type (3 min)
- [ ] Fix 1.5: Fix CsvBase constants (2 min)
- [ ] Fix 2.3: Add disclaimer to VERIFIED files OR delete them (2-15 min)

**Time: ~10-20 minutes**

### This Week
- [ ] Fix 1.3: Add missing methods to DataStoreInterface (10 min)
- [ ] Fix 1.4: Fix DataStoresInterface (15 min)
- [ ] Fix 1.6: Document RefreshableInterface (5 min)
- [ ] Fix 2.2: Add deprecation warnings (30 min)
- [ ] Fix 3.3: Create documentation index (30 min)

**Time: ~1.5 hours**

### This Month
- [ ] Fix 2.1: Replace/deprecate api_reference.md (2-3 hours)
- [ ] Fix 3.1: Verify code examples (2 hours)
- [ ] Fix 3.2: Add source references (1 hour)

**Time: ~5-6 hours**

### When Convenient
- [ ] Phase 4: Formatting and polish (2-4 hours)

---

## Success Metrics

### Before Fixes
- API Reference accuracy: 52%
- Critical errors: 13
- Developer confidence: Low
- Estimated debugging time per developer: 4-8 hours

### After Phase 1 (Critical Fixes)
- API Reference accuracy: ~75%
- Critical errors: 0
- Developer confidence: Medium
- Estimated debugging time per developer: 1-2 hours

### After All Fixes
- Overall documentation accuracy: ~90%
- Critical errors: 0
- Developer confidence: High
- Estimated debugging time per developer: <30 minutes

---

## Automation Recommendations

### Short Term
1. Create shell script to validate method existence
2. Use `php -l` to validate example syntax
3. Create grep-based constant validator

### Long Term
1. Integrate phpDocumentor in CI/CD
2. Auto-generate API reference from source
3. Automated diff checking: generated vs LLM docs
4. Pre-commit hooks to prevent doc/code divergence

---

## Rollback Plan

All fixes are in Markdown files, no code changes required.

**Rollback process:**
1. Git revert specific documentation commits
2. Or restore from backup

**Recommendation:** Create branch `docs/verification-fixes` for all changes

---

## Questions & Support

**For implementation questions:**
- Reference: LLM_DOCUMENTATION_VERIFICATION_REPORT.md
- Reference: SUPPLEMENTARY_VERIFICATION_REPORT.md
- Source code is always ground truth

**For prioritization:**
- P0 fixes are mandatory
- P1 fixes strongly recommended
- P2+ as time permits

---

**End of Action Plan**

Ready to implement? Start with Phase 1 fixes (40 minutes).
